# Halome API 集成修改说明

## 🔧 主要修改

### 1. 认证方式修正
- **修改前**: 使用 `Authorization: Bearer <token>`
- **修改后**: 使用 `AuthToken: <token>`

### 2. 文件列表管理方案
由于 Halome API 没有提供获取文件列表的接口，我们采用了本地存储方案：

#### 本地存储机制
- **存储位置**: `localStorage` 键名 `halome_uploaded_files`
- **存储内容**: 上传成功的文件信息（文件ID、文件名、大小、上传时间等）
- **触发时机**: 文件上传成功后自动保存
- **数据结构**:
```javascript
{
  id: "fileId",           // 从API返回的文件ID
  name: "filename.ext",   // 文件名
  size: 1024000,          // 文件大小（字节）
  uploadTime: 1640995200, // 上传时间戳
  type: "image/jpeg",     // 文件类型
  uploadMethod: "small"   // 上传方式：'small' 或 'chunk'
}
```

### 3. API 接口映射

根据您提供的信息，当前使用的API端点：

#### 小文件上传
- **端点**: `POST /add`
- **认证**: `AuthToken: 1b1427d1c3a88c308a0e0b3d61cf337e`
- **返回**: 包含 `fileId` 的响应对象

#### 大文件分片上传
- **检查文件**: `GET /check-file`
- **上传分片**: `POST /upload-chunk`
- **合并分片**: `POST /merge-chunks`
- **认证**: 所有请求都使用 `AuthToken`

#### 文件下载
- **端点**: `GET /download/{fileId}`
- **认证**: `AuthToken: 1b1427d1c3a88c308a0e0b3d61cf337e`

## 📁 新增文件

### `src/utils/localFileStorage.js`
本地文件存储管理器，提供以下功能：
- ✅ 保存上传成功的文件信息
- ✅ 获取已上传文件列表
- ✅ 搜索文件
- ✅ 删除文件记录
- ✅ 获取统计信息

## 🔄 修改的文件

### `src/api/config.js`
- 修改认证头为 `AuthToken`

### `src/api/fileApi.js`
- 修改所有API请求的认证方式
- 小文件上传成功后保存文件信息
- 大文件合并成功后保存文件信息
- 文件列表获取改为从本地存储读取

### `src/views/Upload.vue`
- 修正合并分片调用，传递文件大小参数

### `src/views/Home.vue`
- 统计数据从本地存储获取
- 最近活动从本地存储的文件记录生成

## 🎯 使用说明

### 1. 上传文件
1. 用户选择文件后，系统自动判断上传方式
2. 上传成功后，文件信息自动保存到本地存储
3. 可在下载页面查看已上传的文件

### 2. 下载文件
1. 下载页面显示本地存储的文件列表
2. 点击下载按钮使用文件ID从Halome API下载
3. 支持搜索和分页功能

### 3. 数据持久性
- 文件记录保存在浏览器本地存储中
- 清除浏览器数据会丢失文件记录
- 建议用户定期备份重要文件信息

## ⚠️ 注意事项

1. **本地存储限制**: 浏览器本地存储有大小限制，当前限制最多保存100个文件记录
2. **跨设备同步**: 本地存储无法跨设备同步，同一文件在不同设备上需要重新上传
3. **数据备份**: 建议用户定期备份重要文件，避免因浏览器数据清除导致文件丢失
4. **API兼容性**: 当前实现基于假设的API响应格式，可能需要根据实际API文档调整

## 🚀 下一步优化建议

1. **服务端文件列表**: 如果Halome API后续提供文件列表接口，可以替换本地存储方案
2. **用户账户系统**: 实现用户登录，将文件记录与用户账户关联
3. **云端同步**: 考虑使用云存储服务同步文件记录
4. **批量操作**: 支持批量下载、删除等操作

## 📝 API文档参考

请根据实际的Halome API文档调整以下内容：
- API基础URL
- 请求/响应格式
- 错误处理机制
- 文件ID格式 